# 4KHDRæ’ä»¶å¼€å‘è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
4. [æ ¸å¿ƒä¼˜åŒ–](#æ ¸å¿ƒä¼˜åŒ–)
5. [APIè®¾è®¡](#apiè®¾è®¡)
6. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
7. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
8. [ç¼“å­˜ç­–ç•¥](#ç¼“å­˜ç­–ç•¥)
9. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
10. [éƒ¨ç½²ç»´æŠ¤](#éƒ¨ç½²ç»´æŠ¤)

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®èƒŒæ™¯

4KHDRæ’ä»¶æ˜¯PanSouæœç´¢å¼•æ“çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨äºæœç´¢4KHDR.CNç½‘ç«™çš„å½±è§†èµ„æºã€‚è¯¥ç½‘ç«™æ˜¯ä¸€ä¸ªé«˜è´¨é‡çš„4Kå½±è§†èµ„æºåˆ†äº«ç¤¾åŒºï¼ŒåŒ…å«å¤§é‡è“å…‰åŸç›˜ã€ç½‘ç›˜èµ„æºç­‰ã€‚

### æ ¸å¿ƒç›®æ ‡

- ğŸ¯ **é«˜æ•ˆæœç´¢**ï¼šå¿«é€Ÿå‡†ç¡®åœ°æœç´¢4KHDRç½‘ç«™çš„å½±è§†èµ„æº
- ğŸ”— **æ™ºèƒ½é“¾æ¥æå–**ï¼šä»å¸–å­å’Œå›å¤ä¸­æå–å„ç§ç½‘ç›˜ä¸‹è½½é“¾æ¥
- ğŸ­ **æ™ºèƒ½è¿‡æ»¤**ï¼šåŒºåˆ†æ±‚ç‰‡å¸–å’Œèµ„æºå¸–ï¼Œä¿ç•™æœ‰ä»·å€¼çš„å†…å®¹
- âš¡ **é«˜æ€§èƒ½**ï¼šæ”¯æŒå¹¶å‘å¤„ç†ï¼Œæä¾›æ¯«ç§’çº§å“åº”é€Ÿåº¦
- ğŸ›¡ï¸ **é«˜å¯é æ€§**ï¼šå…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æŠ€æœ¯æ ˆ

- **ç¼–ç¨‹è¯­è¨€**ï¼šGo 1.21+
- **HTTPå®¢æˆ·ç«¯**ï¼šnet/httpæ ‡å‡†åº“
- **HTMLè§£æ**ï¼šgoqueryï¼ˆåŸºäºjQueryè¯­æ³•ï¼‰
- **å¹¶å‘æ§åˆ¶**ï¼šgoroutine + channel + sync.WaitGroup
- **ç¼“å­˜**ï¼šsync.Mapï¼ˆå†…å­˜ç¼“å­˜ï¼‰
- **æ¶æ„æ¨¡å¼**ï¼šå¼‚æ­¥æ’ä»¶æ¶æ„

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PanSou æœç´¢å¼•æ“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ’ä»¶ç®¡ç†ç³»ç»Ÿ                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   susu      â”‚   hdr4k     â”‚   jikepan   â”‚   å…¶ä»–...   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              hdr4kå¼‚æ­¥æ’ä»¶æ¶æ„                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               æœç´¢æ§åˆ¶å±‚                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ å¼‚æ­¥æœç´¢æ§åˆ¶ (AsyncSearch)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ ç¼“å­˜ç®¡ç† (CacheManager)                            â”‚ â”‚
â”‚  â”‚  â””â”€ è¶…æ—¶æ§åˆ¶ (TimeoutControl)                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               å¹¶å‘å¤„ç†å±‚                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ ä¿¡å·é‡æ§åˆ¶ (Semaphore)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Goroutineæ± ç®¡ç†                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Channelé€šä¿¡                                         â”‚ â”‚
â”‚  â”‚  â””â”€ WaitGroupåè°ƒ                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               ç½‘ç»œè¯·æ±‚å±‚                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ HTTPå®¢æˆ·ç«¯ç®¡ç†                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ é‡è¯•æœºåˆ¶ (Retry Logic)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ UAè½®æ¢ (User-Agent Pool)                            â”‚ â”‚
â”‚  â”‚  â””â”€ è¿æ¥æ± ç®¡ç†                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               æ•°æ®å¤„ç†å±‚                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ HTMLè§£æ (goquery)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ å†…å®¹æ¸…ç† (HTML Cleaning)                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ é“¾æ¥æå– (Link Extraction)                          â”‚ â”‚
â”‚  â”‚  â””â”€ æ•°æ®ç»“æ„åŒ– (Data Structuring)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. Hdr4kAsyncPluginï¼ˆä¸»æ’ä»¶ç±»ï¼‰

```go
type Hdr4kAsyncPlugin struct {
    *plugin.BaseAsyncPlugin
}
```

**èŒè´£**ï¼š
- å®ç°PanSouæ’ä»¶æ¥å£
- ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸ
- æä¾›å¼‚æ­¥æœç´¢èƒ½åŠ›

#### 2. ç¼“å­˜ç³»ç»Ÿ

```go
var (
    detailPageCache   = sync.Map{}  // è¯¦æƒ…é¡µç¼“å­˜
    searchResultCache = sync.Map{}  // æœç´¢ç»“æœç¼“å­˜
    linkTypeCache     = sync.Map{}  // é“¾æ¥ç±»å‹ç¼“å­˜
)
```

**èŒè´£**ï¼š
- å‡å°‘é‡å¤ç½‘ç»œè¯·æ±‚
- æå‡å“åº”é€Ÿåº¦
- é™ä½æœåŠ¡å™¨å‹åŠ›

#### 3. å¹¶å‘æ§åˆ¶å™¨

```go
semaphore := make(chan struct{}, MaxConcurrency)
var wg sync.WaitGroup
```

**èŒè´£**ï¼š
- æ§åˆ¶å¹¶å‘æ•°é‡
- åè°ƒgoroutineæ‰§è¡Œ
- é˜²æ­¢èµ„æºè¿‡åº¦æ¶ˆè€—

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æœç´¢æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant P as PanSouå¼•æ“
    participant H as hdr4kæ’ä»¶
    participant S as 4KHDRç½‘ç«™
    participant C as ç¼“å­˜ç³»ç»Ÿ

    U->>P: æœç´¢è¯·æ±‚
    P->>H: è°ƒç”¨æ’ä»¶æœç´¢
    H->>C: æ£€æŸ¥ç¼“å­˜
    alt ç¼“å­˜å‘½ä¸­
        C-->>H: è¿”å›ç¼“å­˜ç»“æœ
    else ç¼“å­˜æœªå‘½ä¸­
        H->>S: å‘é€æœç´¢è¯·æ±‚
        S-->>H: è¿”å›æœç´¢é¡µé¢
        H->>H: è§£ææœç´¢ç»“æœ
        par å¹¶å‘å¤„ç†æ¯ä¸ªç»“æœ
            H->>S: è·å–è¯¦æƒ…é¡µ1
            and
            H->>S: è·å–è¯¦æƒ…é¡µ2
            and
            H->>S: è·å–è¯¦æƒ…é¡µN
        end
        S-->>H: è¿”å›è¯¦æƒ…é¡µå†…å®¹
        H->>H: æå–ä¸‹è½½é“¾æ¥
        H->>H: è¿‡æ»¤æ±‚ç‰‡å¸–
        H->>C: æ›´æ–°ç¼“å­˜
    end
    H-->>P: è¿”å›ç»“æ„åŒ–ç»“æœ
    P-->>U: è¿”å›æœç´¢ç»“æœ
```

### æ ¸å¿ƒç®—æ³•

#### 1. æ™ºèƒ½æ±‚ç‰‡å¸–è¿‡æ»¤ç®—æ³•

```go
func (p *Hdr4kAsyncPlugin) isEmptyRequestPost(title string, links []model.Link) bool {
    // ç®—æ³•é€»è¾‘ï¼š
    // 1. å¦‚æœæœ‰å®é™…ä¸‹è½½é“¾æ¥ï¼Œä¿ç•™å¸–å­
    // 2. è¯†åˆ«æ˜ç¡®çš„æ±‚ç‰‡å…³é”®è¯
    // 3. å¯¹æ±‚ç½‘ç›˜å¸–å­ç‰¹æ®Šå¤„ç†
    // 4. è€ƒè™‘æ ‡é¢˜é•¿åº¦å’Œå†…å®¹ç‰¹å¾
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… é¿å…è¯¯æ€æœ‰èµ„æºçš„æ±‚ç‰‡å¸–
- âœ… è¿‡æ»¤æ— ä»·å€¼çš„çº¯æ±‚ç‰‡å¸–
- âœ… æ”¯æŒå¤šç§æ±‚ç‰‡æ¨¡å¼è¯†åˆ«

#### 2. å¹¶å‘è¯¦æƒ…é¡µå¤„ç†ç®—æ³•

```go
func (p *Hdr4kAsyncPlugin) doSearch(client *http.Client, keyword string, ext map[string]interface{}) ([]model.SearchResult, error) {
    // ç®—æ³•æµç¨‹ï¼š
    // 1. é¢„è¿‡æ»¤ï¼šåªå¤„ç†åŒ…å«å…³é”®è¯çš„å¸–å­
    // 2. ä¿¡å·é‡æ§åˆ¶ï¼šé™åˆ¶å¹¶å‘æ•°é‡
    // 3. å¹¶å‘å¤„ç†ï¼šæ¯ä¸ªè¯¦æƒ…é¡µç‹¬ç«‹å¤„ç†
    // 4. ç»“æœæ”¶é›†ï¼šé€šè¿‡channelå®‰å…¨æ±‡æ€»
}
```

**ä¼˜åŠ¿**ï¼š
- âš¡ å¤§å¹…æå‡å¤„ç†é€Ÿåº¦
- ğŸ›¡ï¸ é¿å…è¿‡åº¦å¹¶å‘å¯¼è‡´çš„é—®é¢˜
- ğŸ”„ æ”¯æŒé”™è¯¯éš”ç¦»

#### 3. æ™ºèƒ½é‡è¯•ç®—æ³•

```go
func (p *Hdr4kAsyncPlugin) doRequestWithRetry(client *http.Client, req *http.Request, maxRetries int) (*http.Response, error) {
    // æŒ‡æ•°é€€é¿ç®—æ³•ï¼š
    // ç¬¬1æ¬¡é‡è¯•ï¼šç­‰å¾…500ms
    // ç¬¬2æ¬¡é‡è¯•ï¼šç­‰å¾…1000ms
    // ç¬¬3æ¬¡é‡è¯•ï¼šç­‰å¾…2000ms
    // æœ€å¤§ç­‰å¾…ï¼š5000ms
}
```

**ä¼˜åŠ¿**ï¼š
- ğŸ”„ è‡ªåŠ¨å¤„ç†ç½‘ç»œæŠ–åŠ¨
- â±ï¸ é¿å…è¯·æ±‚é£æš´
- ğŸ“ˆ æé«˜è¯·æ±‚æˆåŠŸç‡

---

## ğŸš€ æ ¸å¿ƒä¼˜åŒ–

### 1. å¼‚æ­¥æ’ä»¶æ¶æ„

**ä¼˜åŒ–å‰**ï¼šåŒæ­¥æ’ä»¶æ¶æ„
```go
type Hdr4kPlugin struct {
    client  *http.Client
    timeout time.Duration
}
```

**ä¼˜åŒ–å**ï¼šå¼‚æ­¥æ’ä»¶æ¶æ„
```go
type Hdr4kAsyncPlugin struct {
    *plugin.BaseAsyncPlugin
}
```

**æ”¶ç›Š**ï¼š
- â±ï¸ æ›´å¥½çš„è¶…æ—¶æ§åˆ¶
- ğŸ”„ å†…ç½®ç¼“å­˜ç®¡ç†
- ğŸ“Š æ€§èƒ½ç›‘æ§æ”¯æŒ
- ğŸ›¡ï¸ é”™è¯¯æ¢å¤æœºåˆ¶

### 2. å¹¶å‘å¤„ç†ä¼˜åŒ–

**ä¼˜åŒ–å‰**ï¼šä¸²è¡Œå¤„ç†è¯¦æƒ…é¡µ
```go
doc.Find(".slst.mtw ul li.pbw").Each(func(i int, s *goquery.Selection) {
    // ä¸²è¡Œå¤„ç†æ¯ä¸ªç»“æœ
    links, content := getLinksFromDetail(postID)
    // ...
})
```

**ä¼˜åŒ–å**ï¼šå¹¶å‘å¤„ç†è¯¦æƒ…é¡µ
```go
// é¢„æ”¶é›†éœ€è¦å¤„ç†çš„é¡¹
var items []*goquery.Selection
doc.Find(".slst.mtw ul li.pbw").Each(func(i int, s *goquery.Selection) {
    if matched {
        items = append(items, s)
    }
})

// å¹¶å‘å¤„ç†
for i, s := range items {
    wg.Add(1)
    go func(index int, s *goquery.Selection) {
        defer wg.Done()
        semaphore <- struct{}{}
        defer func() { <-semaphore }()
        
        // å¤„ç†è¯¦æƒ…é¡µ
        links, content, err := getLinksFromDetail(client, postID)
        // ...
    }(i, s)
}
```

**æ”¶ç›Š**ï¼š
- âš¡ é€Ÿåº¦æå‡3-5å€
- ğŸ”„ æ›´å¥½çš„èµ„æºåˆ©ç”¨
- ğŸ“Š æ”¯æŒåŠ¨æ€å¹¶å‘è°ƒæ•´

### 3. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

**å¤šå±‚çº§ç¼“å­˜è®¾è®¡**ï¼š

```go
// 1. æœç´¢ç»“æœç¼“å­˜
searchResultCache.Store(searchKey, results)

// 2. è¯¦æƒ…é¡µç¼“å­˜
detailPageCache.Store(postID, detailContent)

// 3. é“¾æ¥ç±»å‹ç¼“å­˜
linkTypeCache.Store(urlKey, linkType)
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- â±ï¸ TTL: 1å°æ—¶è‡ªåŠ¨è¿‡æœŸ
- ğŸ”„ LRU: å†…å­˜å‹åŠ›æ—¶è‡ªåŠ¨æ¸…ç†
- ğŸ”‘ æ™ºèƒ½é”®å€¼: åŸºäºå†…å®¹ç‰¹å¾ç”Ÿæˆ

### 4. ç½‘ç»œä¼˜åŒ–

**User-Agentè½®æ¢**ï¼š
```go
var userAgents = []string{
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36...",
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...",
    // ...
}

func getRandomUA() string {
    return userAgents[rand.Intn(len(userAgents))]
}
```

**é‡è¯•æœºåˆ¶**ï¼š
- ğŸ”„ æŒ‡æ•°é€€é¿ç®—æ³•
- ğŸ¯ æ™ºèƒ½é”™è¯¯åˆ¤æ–­
- â±ï¸ åˆç†è¶…æ—¶è®¾ç½®

---

## ğŸ“¡ APIè®¾è®¡

### æ’ä»¶æ¥å£

```go
type Plugin interface {
    Name() string
    Priority() int
    Search(keyword string, ext map[string]interface{}) ([]model.SearchResult, error)
}
```

### æ•°æ®ç»“æ„

#### SearchResultï¼ˆæœç´¢ç»“æœï¼‰

```go
type SearchResult struct {
    UniqueID  string    `json:"unique_id"`  // å”¯ä¸€æ ‡è¯†
    Title     string    `json:"title"`      // æ ‡é¢˜
    Content   string    `json:"content"`    // å†…å®¹æè¿°
    Datetime  time.Time `json:"datetime"`   // å‘å¸ƒæ—¶é—´
    Links     []Link    `json:"links"`      // ä¸‹è½½é“¾æ¥
    Tags      []string  `json:"tags"`       // åˆ†ç±»æ ‡ç­¾
}
```

#### Linkï¼ˆä¸‹è½½é“¾æ¥ï¼‰

```go
type Link struct {
    URL      string `json:"url"`      // ä¸‹è½½åœ°å€
    Type     string `json:"type"`     // é“¾æ¥ç±»å‹
    Password string `json:"password"` // æå–å¯†ç 
}
```

### æ”¯æŒçš„é“¾æ¥ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `quark` | å¤¸å…‹ç½‘ç›˜ | https://pan.quark.cn/s/xxx |
| `baidu` | ç™¾åº¦ç½‘ç›˜ | https://pan.baidu.com/s/xxx |
| `aliyun` | é˜¿é‡Œäº‘ç›˜ | https://alipan.com/s/xxx |
| `xunlei` | è¿…é›·ç½‘ç›˜ | https://pan.xunlei.com/s/xxx |
| `tianyi` | å¤©ç¿¼äº‘ç›˜ | https://cloud.189.cn/xxx |
| `115` | 115ç½‘ç›˜ | https://115.com/xxx |
| `magnet` | ç£åŠ›é“¾æ¥ | magnet:?xt=urn:btih:xxx |
| `ed2k` | ç”µé©´é“¾æ¥ | ed2k://xxx |

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. é¢„è¿‡æ»¤æœºåˆ¶

```go
// åœ¨å‘èµ·ç½‘ç»œè¯·æ±‚å‰å…ˆè¿‡æ»¤
doc.Find(".slst.mtw ul li.pbw").Each(func(i int, s *goquery.Selection) {
    title := extractTitle(s)
    if !matchesKeywords(title, keywords) {
        return // è·³è¿‡ä¸åŒ¹é…çš„å¸–å­
    }
    items = append(items, s)
})
```

**æ”¶ç›Š**ï¼šå‡å°‘60-80%çš„æ— æ•ˆç½‘ç»œè¯·æ±‚

#### 2. æ™ºèƒ½ç¼“å­˜

```go
// åŸºäºå†…å®¹ç‰¹å¾ç”Ÿæˆç¼“å­˜é”®
cacheKey := fmt.Sprintf("detail:%s", postID)
if cachedData, ok := detailPageCache.Load(cacheKey); ok {
    if time.Since(cachedResult.timestamp) < cacheTTL {
        return cachedData // ç›´æ¥è¿”å›ç¼“å­˜
    }
}
```

**æ”¶ç›Š**ï¼šç¼“å­˜å‘½ä¸­æ—¶å“åº”é€Ÿåº¦æå‡95%

#### 3. è¿æ¥å¤ç”¨

```go
// ä½¿ç”¨å¸¦è¿æ¥æ± çš„HTTPå®¢æˆ·ç«¯
client := &http.Client{
    Timeout: timeout,
    Transport: &http.Transport{
        MaxIdleConns:        100,
        MaxIdleConnsPerHost: 20,
        IdleConnTimeout:     90 * time.Second,
    },
}
```

**æ”¶ç›Š**ï¼šå‡å°‘TCPè¿æ¥å»ºç«‹å¼€é”€ï¼Œæå‡20-30%æ€§èƒ½

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### é”™è¯¯åˆ†ç±»

#### 1. ç½‘ç»œé”™è¯¯

```go
func (p *Hdr4kAsyncPlugin) isRetriableError(err error) bool {
    if netErr, ok := err.(net.Error); ok {
        return netErr.Timeout() || netErr.Temporary()
    }
    
    errStr := err.Error()
    return strings.Contains(errStr, "connection refused") ||
           strings.Contains(errStr, "connection reset") ||
           strings.Contains(errStr, "EOF")
}
```

**å¤„ç†ç­–ç•¥**ï¼š
- ğŸ”„ è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š2æ¬¡ï¼‰
- â±ï¸ æŒ‡æ•°é€€é¿ç­‰å¾…
- ğŸ“Š é”™è¯¯ç»Ÿè®¡è®°å½•

#### 2. è§£æé”™è¯¯

```go
doc, err := goquery.NewDocumentFromReader(resp.Body)
if err != nil {
    return nil, fmt.Errorf("è§£æHTMLå¤±è´¥: %w", err)
}
```

**å¤„ç†ç­–ç•¥**ï¼š
- è¯¦ç»†é”™è¯¯æ—¥å¿—
- é™çº§å¤„ç†æœºåˆ¶
- ç›‘æ§å‘Šè­¦

#### 3. æ•°æ®é”™è¯¯

```go
if title == "" {
    return // è·³è¿‡æ— æ•ˆæ•°æ®
}
```

**å¤„ç†ç­–ç•¥**ï¼š
- ğŸ§¹ æ•°æ®æ¸…æ´—
- ğŸ”„ å®¹é”™å¤„ç†
- ğŸ“Š è´¨é‡ç›‘æ§

### å®¹é”™è®¾è®¡

#### 1. ä¼˜é›…é™çº§

```go
links, detailContent, err := p.getLinksFromDetail(client, postID)
if err != nil {
    // é™çº§ï¼šè¿”å›æœç´¢é¡µé¢çš„åŸºæœ¬ä¿¡æ¯
    links = []model.Link{}
    detailContent = content
}
```

#### 2. éƒ¨åˆ†å¤±è´¥å®¹å¿

```go
// å³ä½¿éƒ¨åˆ†è¯¦æƒ…é¡µè·å–å¤±è´¥ï¼Œä»è¿”å›æˆåŠŸè·å–çš„ç»“æœ
for result := range resultChan {
    results = append(results, result)
}
```

#### 3. è¶…æ—¶ä¿æŠ¤

```go
// é€šè¿‡å¼‚æ­¥æ’ä»¶æ¶æ„æä¾›è¶…æ—¶ä¿æŠ¤
return p.AsyncSearch(keyword, p.doSearch, p.MainCacheKey, ext)
```

---

## ğŸ’¾ ç¼“å­˜ç­–ç•¥

### ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å­˜ç¼“å­˜ç³»ç»Ÿ                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æœç´¢ç»“æœç¼“å­˜   â”‚  â”‚   è¯¦æƒ…é¡µç¼“å­˜    â”‚  â”‚  é“¾æ¥ç±»å‹ç¼“å­˜   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚ searchResultCacheâ”‚  â”‚ detailPageCache â”‚  â”‚ linkTypeCache   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚ TTL: 1å°æ—¶      â”‚  â”‚ TTL: 1å°æ—¶      â”‚  â”‚ TTL: 1å°æ—¶      â”‚ â”‚
â”‚  â”‚ å‘½ä¸­ç‡: 70-85%  â”‚  â”‚ å‘½ä¸­ç‡: 60-75%  â”‚  â”‚ å‘½ä¸­ç‡: 90%+    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼“å­˜é”®è®¾è®¡

#### 1. æœç´¢ç»“æœç¼“å­˜é”®

```go
// æ ¼å¼ï¼šsearch:{keyword}:{hash(ext)}
searchKey := fmt.Sprintf("search:%s:%x", keyword, hashExt(ext))
```

#### 2. è¯¦æƒ…é¡µç¼“å­˜é”®

```go
// æ ¼å¼ï¼šdetail:{postID}
detailKey := fmt.Sprintf("detail:%s", postID)
```

#### 3. é“¾æ¥ç±»å‹ç¼“å­˜é”®

```go
// æ ¼å¼ï¼šlinktype:{url}:{name}
linkTypeKey := fmt.Sprintf("%s:%s", url, name)
```

### ç¼“å­˜æ›´æ–°ç­–ç•¥

#### 1. æ—¶é—´è¿‡æœŸï¼ˆTTLï¼‰

```go
type cachedResponse struct {
    data      interface{}
    timestamp time.Time
}

// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
if time.Since(cachedResult.timestamp) < cacheTTL {
    return cachedData
}
```

#### 2. å®šæœŸæ¸…ç†

```go
func startCacheCleaner() {
    ticker := time.NewTicker(1 * time.Hour)
    defer ticker.Stop()
    
    for range ticker.C {
        // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
        detailPageCache = sync.Map{}
        searchResultCache = sync.Map{}
        linkTypeCache = sync.Map{}
    }
}
```

#### 3. å†…å­˜å‹åŠ›æ¸…ç†

```go
// TODO: å®ç°åŸºäºå†…å­˜ä½¿ç”¨é‡çš„æ™ºèƒ½æ¸…ç†
// å½“å†…å­˜ä½¿ç”¨è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼˜å…ˆæ¸…ç†æœ€ä¹…æœªä½¿ç”¨çš„ç¼“å­˜
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

#### 1. æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

```go
func TestHTMLParsingWithRealData(t *testing.T) {
    plugin := NewHdr4kAsyncPlugin()
    
    // æµ‹è¯•HTMLæ¸…ç†
    htmlTitle := `<strong><font color="#ff0000">æ°´é¥ºçš‡å</font></strong> 2025`
    cleanedTitle := plugin.cleanHTML(htmlTitle)
    expected := "æ°´é¥ºçš‡å 2025"
    
    assert.Equal(t, expected, cleanedTitle)
}
```

#### 2. æ±‚ç‰‡å¸–è¿‡æ»¤æµ‹è¯•

```go
func TestEmptyRequestPostFiltering(t *testing.T) {
    plugin := NewHdr4kAsyncPlugin()
    
    testCases := []struct {
        title    string
        links    []model.Link
        expected bool
    }{
        {"æ±‚å¤¸å…‹ç½‘ç›˜ çŠ¬å¤œå‰", []model.Link{}, true},
        {"æ±‚å¤¸å…‹ç½‘ç›˜ çŠ¬å¤œå‰", []model.Link{{URL: "https://pan.quark.cn/s/xxx", Type: "quark"}}, false},
        {"çŠ¬å¤œå‰ 2000", []model.Link{}, false},
    }
    
    for _, tc := range testCases {
        result := plugin.isEmptyRequestPost(tc.title, tc.links)
        assert.Equal(t, tc.expected, result)
    }
}
```

#### 3. å¹¶å‘å®‰å…¨æµ‹è¯•

```go
func TestConcurrentSearches(t *testing.T) {
    plugin := NewHdr4kAsyncPlugin()
    
    var wg sync.WaitGroup
    const numGoroutines = 10
    
    for i := 0; i < numGoroutines; i++ {
        wg.Add(1)
        go func() {
            defer wg.Done()
            _, err := plugin.Search("æµ‹è¯•å…³é”®è¯", nil)
            assert.NoError(t, err)
        }()
    }
    
    wg.Wait()
}
```

### é›†æˆæµ‹è¯•

#### 1. ç«¯åˆ°ç«¯æµ‹è¯•

```go
func TestE2ESearch(t *testing.T) {
    plugin := NewHdr4kAsyncPlugin()
    
    // æµ‹è¯•çœŸå®æœç´¢
    results, err := plugin.Search("çŠ¬å¤œå‰", nil)
    assert.NoError(t, err)
    assert.NotEmpty(t, results)
    
    // éªŒè¯ç»“æœè´¨é‡
    for _, result := range results {
        assert.NotEmpty(t, result.Title)
        assert.NotEmpty(t, result.UniqueID)
        assert.Contains(t, strings.ToLower(result.Title), "çŠ¬å¤œå‰")
    }
}
```

#### 2. æ€§èƒ½æµ‹è¯•

```go
func BenchmarkSearch(b *testing.B) {
    plugin := NewHdr4kAsyncPlugin()
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        _, err := plugin.Search("æµ‹è¯•", nil)
        if err != nil {
            b.Fatal(err)
        }
    }
}
```

### å‹åŠ›æµ‹è¯•

#### 1. å¹¶å‘å‹åŠ›æµ‹è¯•

```bash
# ä½¿ç”¨wrkè¿›è¡Œå‹åŠ›æµ‹è¯•
wrk -t10 -c100 -d30s --timeout 10s \
    'http://localhost:8888/api/search?kw=çŠ¬å¤œå‰&src=plugin&plugins=hdr4k'
```

#### 2. å†…å­˜å‹åŠ›æµ‹è¯•

```go
func TestMemoryUsage(t *testing.T) {
    plugin := NewHdr4kAsyncPlugin()
    
    var m1, m2 runtime.MemStats
    runtime.ReadMemStats(&m1)
    
    // æ‰§è¡Œå¤§é‡æœç´¢
    for i := 0; i < 100; i++ {
        plugin.Search(fmt.Sprintf("test%d", i), nil)
    }
    
    runtime.ReadMemStats(&m2)
    memUsage := m2.Alloc - m1.Alloc
    
    // éªŒè¯å†…å­˜ä½¿ç”¨åœ¨åˆç†èŒƒå›´å†…
    assert.Less(t, memUsage, uint64(50*1024*1024)) // 50MB
}
```

---

## ğŸš€ éƒ¨ç½²ç»´æŠ¤

### éƒ¨ç½²è¦æ±‚

#### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šLinux/macOS/Windows
- **Goç‰ˆæœ¬**ï¼š1.21+
- **å†…å­˜**ï¼šæœ€å°512MBï¼Œæ¨è2GB+
- **CPU**ï¼šæœ€å°1æ ¸ï¼Œæ¨è2æ ¸+
- **ç½‘ç»œ**ï¼šç¨³å®šçš„å¤–ç½‘è¿æ¥

#### ä¾èµ–åº“

```go
require (
    github.com/PuerkitoBio/goquery v1.8.1
    // å…¶ä»–ä¾èµ–...
)
```

### é…ç½®å‚æ•°

#### æ€§èƒ½é…ç½®

```go
const (
    DefaultTimeout   = 10 * time.Second  // è¯·æ±‚è¶…æ—¶æ—¶é—´
    MaxRetries       = 2                 // æœ€å¤§é‡è¯•æ¬¡æ•°
    MaxConcurrency   = 20                // æœ€å¤§å¹¶å‘æ•°
    CacheTTL         = 1 * time.Hour     // ç¼“å­˜æœ‰æ•ˆæœŸ
)
```

#### ç¯å¢ƒå˜é‡

```bash
# å¯é€‰çš„ç¯å¢ƒå˜é‡é…ç½®
export HDR4K_TIMEOUT=10s
export HDR4K_MAX_RETRIES=2
export HDR4K_MAX_CONCURRENCY=20
export HDR4K_CACHE_TTL=1h
```

### ç›‘æ§æŒ‡æ ‡

#### å…³é”®æŒ‡æ ‡

1. **æ€§èƒ½æŒ‡æ ‡**
   - å¹³å‡å“åº”æ—¶é—´
   - P95/P99å“åº”æ—¶é—´
   - QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰
   - é”™è¯¯ç‡

2. **èµ„æºæŒ‡æ ‡**
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨é‡
   - ç½‘ç»œI/O
   - å¹¶å‘è¿æ¥æ•°

3. **ä¸šåŠ¡æŒ‡æ ‡**
   - æœç´¢æˆåŠŸç‡
   - ç¼“å­˜å‘½ä¸­ç‡
   - é“¾æ¥æå–æˆåŠŸç‡
   - æ±‚ç‰‡å¸–è¿‡æ»¤å‡†ç¡®ç‡

#### ç›‘æ§å®ç°

```go
// æ·»åŠ prometheusæŒ‡æ ‡ï¼ˆç¤ºä¾‹ï¼‰
var (
    searchDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "hdr4k_search_duration_seconds",
            Help: "Time spent on search requests",
        },
        []string{"status"},
    )
    
    cacheHitRate = prometheus.NewGaugeVec(
        prometheus.GaugeOpts{
            Name: "hdr4k_cache_hit_rate",
            Help: "Cache hit rate",
        },
        []string{"cache_type"},
    )
)
```

### æ—¥å¿—ç®¡ç†

#### æ—¥å¿—çº§åˆ«

```go
// å»ºè®®çš„æ—¥å¿—çº§åˆ«
const (
    DEBUG = "debug"  // è¯¦ç»†è°ƒè¯•ä¿¡æ¯
    INFO  = "info"   // ä¸€èˆ¬ä¿¡æ¯
    WARN  = "warn"   // è­¦å‘Šä¿¡æ¯
    ERROR = "error"  // é”™è¯¯ä¿¡æ¯
)
```

#### å…³é”®æ—¥å¿—ç‚¹

```go
// æœç´¢å¼€å§‹
log.Info("å¼€å§‹æœç´¢", "keyword", keyword, "plugin", "hdr4k")

// æ€§èƒ½ç»Ÿè®¡
log.Info("æœç´¢å®Œæˆ", "keyword", keyword, "ç»“æœæ•°", len(results), "è€—æ—¶", duration)

// é”™è¯¯è®°å½•
log.Error("è¯¦æƒ…é¡µè·å–å¤±è´¥", "postID", postID, "error", err)

// ç¼“å­˜çŠ¶æ€
log.Debug("ç¼“å­˜å‘½ä¸­", "key", cacheKey, "type", "detail_page")
```

### æ•…éšœæ’æŸ¥

#### å¸¸è§é—®é¢˜

1. **æœç´¢æ— ç»“æœ**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯ç›®æ ‡ç½‘ç«™å¯è®¿é—®æ€§
   - æ£€æŸ¥HTMLç»“æ„æ˜¯å¦å‘ç”Ÿå˜åŒ–

2. **å“åº”æ—¶é—´è¿‡é•¿**
   - æ£€æŸ¥å¹¶å‘è®¾ç½®æ˜¯å¦åˆç†
   - éªŒè¯ç¼“å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - ç›‘æ§ç½‘ç»œå»¶è¿Ÿ

3. **å†…å­˜ä½¿ç”¨è¿‡é«˜**
   - æ£€æŸ¥ç¼“å­˜æ¸…ç†æ˜¯å¦æ­£å¸¸
   - ç›‘æ§goroutineæ³„æ¼
   - éªŒè¯è¿æ¥æ± é…ç½®

---

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

#### å‘½åè§„èŒƒ

```go
// 1. åŒ…åï¼šå°å†™ï¼Œç®€æ´
package hdr4k

// 2. ç»“æ„ä½“ï¼šå¤§é©¼å³°å‘½å
type Hdr4kAsyncPlugin struct {}

// 3. æ¥å£ï¼šå¤§é©¼å³°å‘½åï¼Œä»¥erç»“å°¾
type Searcher interface {}

// 4. æ–¹æ³•ï¼šå¤§é©¼å³°å‘½åï¼ˆå…¬å¼€ï¼‰ï¼Œå°é©¼å³°å‘½åï¼ˆç§æœ‰ï¼‰
func (p *Hdr4kAsyncPlugin) Search() {}
func (p *Hdr4kAsyncPlugin) doSearch() {}

// 5. å˜é‡ï¼šå°é©¼å³°å‘½å
var detailPageCache = sync.Map{}

// 6. å¸¸é‡ï¼šå¤§å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
const MAX_RETRIES = 3
```

#### æ³¨é‡Šè§„èŒƒ

```go
// Hdr4kAsyncPlugin 4KHDRç½‘ç«™æœç´¢å¼‚æ­¥æ’ä»¶
// 
// è¯¥æ’ä»¶å®ç°äº†å¯¹4KHDR.CNç½‘ç«™çš„é«˜æ•ˆæœç´¢åŠŸèƒ½ï¼Œæ”¯æŒï¼š
// - å¹¶å‘æœç´¢å¤„ç†
// - æ™ºèƒ½ç¼“å­˜æœºåˆ¶
// - è‡ªåŠ¨é‡è¯•åŠŸèƒ½
// - æ±‚ç‰‡å¸–æ™ºèƒ½è¿‡æ»¤
type Hdr4kAsyncPlugin struct {
    *plugin.BaseAsyncPlugin
}

// Search æ‰§è¡Œæœç´¢å¹¶è¿”å›ç»“æœ
//
// å‚æ•°ï¼š
//   keyword: æœç´¢å…³é”®è¯
//   ext: æ‰©å±•å‚æ•°ï¼Œå¯åŒ…å«title_enç­‰å­—æ®µ
//
// è¿”å›å€¼ï¼š
//   []model.SearchResult: æœç´¢ç»“æœåˆ—è¡¨
//   error: é”™è¯¯ä¿¡æ¯
func (p *Hdr4kAsyncPlugin) Search(keyword string, ext map[string]interface{}) ([]model.SearchResult, error) {
    // å®ç°é€»è¾‘...
}
```

### æœ€ä½³å®è·µ

#### 1. é”™è¯¯å¤„ç†

```go
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨wrap error
if err != nil {
    return nil, fmt.Errorf("è§£æHTMLå¤±è´¥: %w", err)
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šä¸¢å¤±é”™è¯¯ä¸Šä¸‹æ–‡
if err != nil {
    return nil, err
}
```

#### 2. èµ„æºç®¡ç†

```go
// âœ… å¥½çš„åšæ³•ï¼šç¡®ä¿èµ„æºé‡Šæ”¾
resp, err := client.Do(req)
if err != nil {
    return err
}
defer resp.Body.Close()

// âŒ ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°é‡Šæ”¾èµ„æº
resp, err := client.Do(req)
if err != nil {
    return err
}
// ç¼ºå°‘ defer resp.Body.Close()
```

#### 3. å¹¶å‘å®‰å…¨

```go
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨sync.Mapä¿è¯å¹¶å‘å®‰å…¨
var cache = sync.Map{}

// âŒ ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨æ™®é€šmapå¯èƒ½å¯¼è‡´race condition
var cache = make(map[string]interface{})
```
